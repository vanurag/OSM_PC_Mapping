% ETH Zurich  - 3D Photography 2015
% http://www.cvg.ethz.ch/teaching/3dphoto/
% Template for project proposals

\documentclass[11pt,a4paper,oneside,onecolumn]{IEEEtran}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[x11names]{xcolor}
\usepackage{colortbl}
\usepackage{caption}
% \usepackage{fourier, heuristica}
\usepackage{array, booktabs}
\DeclareCaptionFont{blue}{\color{LightSteelBlue3}}
\newcommand{\foo}{\color{LightSteelBlue3}\makebox[0pt]{\textbullet}\hskip-0.5pt\vrule width 1pt\hspace{\labelsep}}
% Enter the project title and your project supervisor here
\newcommand{\ProjectTitle}{Mapping point clouds to OSM Building Outlines}
\newcommand{\ProjectSupervisor}{Torsten Sattler}
\newcommand{\DateOfReport}{March 6, 2015}

% Enter the team members' names and path to their photos. Comment / uncomment related definitions if the number of members are different than 2.
% Including photographs are optional. Photos are there to help us to evaluate your group more effectively. If you wish not to include your photos, please comment the following line.
\newcommand{\PutPhotos}{}
% Please include a clear photo of each member. (use pdf or png files for Latex to embed them in the document well)
\newcommand{\memberone}{Anurag Sai Vempati}
\newcommand{\memberonepicture}{anurag.png}
\newcommand{\membertwo}{Wolf Vollprecht}
\newcommand{\membertwopicture}{images/wolf.jpg}
%\newcommand{\memberthree}{Member Name}
%\newcommand{\memberthreepicture}{pic3.png}


%%%% DO NOT EDIT THE PART BELOW %%%%
\title{\ProjectTitle}
\author{\memberone, \membertwo\\Supervised by: \ProjectSupervisor\\ \DateOfReport}
\begin{document}
\maketitle
\vspace{-1.5cm}\section*{Group Members}\vspace{0.3cm}
\begin{center}\begin{minipage}{\linewidth}\begin{center}
\begin{minipage}{3 cm}\begin{center}\memberone\ifdefined\PutPhotos\\\vspace{0.2cm}\includegraphics[height=3cm]{\memberonepicture}\fi\end{center}\end{minipage}
\ifdefined\membertwo\begin{minipage}{3 cm}\begin{center}\membertwo\ifdefined\PutPhotos\\\vspace{0.2cm}\includegraphics[height=3cm]{\membertwopicture}\fi\end{center}\end{minipage}\fi
\ifdefined\memberthree\begin{minipage}{3 cm}\begin{center}\memberthree\ifdefined\PutPhotos\\\vspace{0.2cm}\includegraphics[height=3cm]{\memberthreepicture}\fi\end{center}\end{minipage}\fi
\end{center}\end{minipage}\end{center}\vspace{0.3cm}
%%%% END OF PROTECTED LINES %%%%


%%%% BEGIN WRITING THE DOCUMENT HERE %%%%

\section{Description of the project}

The project aims to map point cloud data of outdoor city environments to \textit{OpenStreetMap}\footnote{\url{osm.org}} (OSM) building outlines, manually mapped by humans.
The point cloud data is generated by using the Structure-from-Motion technique to extract 3D data from multiple photographs taken from different viewpoints. The photographs are taken by consumer grade cameras and processed by software like VisualSFM~\cite{wu2011visualsfm}.

To enrich the point cloud data we want to map the facade outlines of the point cloud to rich data that we get from OSM. This will allow us to identify, for example, shops and to tag different houses which might not work at all, or not correctly without OSM data.

Furthermore, it is in the scope of the project to automatically extract building heights from the point cloud data. Once the data is aligned to OSM, it will be possible to get absolute lengths from the point cloud data. As OSM is a collaborative effort, the software might enable us to contribute back the building height data. Another eventual addition would be to semi-automatically estimate the roof shape from 2D-Data that is merged with the OSM and point cloud data.

Reconstruction of cityscapes is a well-researched field. Merging OSM data with point clouds and aligning them has been done by Untzelmann et al. \cite{6755957} for the purpose of generating 3D representations of buildings. An indepth approach to georegistration of SfM point clouds was described by Wang~\cite{wang2013accurate}. Strecha~\cite{EPFL-CONF-148247} has shown how large scale city reconstruction from many photographs can be efficiently implemented, using the available metadata, as well as fitting the pointcloud on map data.
Reconstruction of abstract building geometry (including roof shape) on basis of aerial \textsc{Lidar} data has been done by Verma~\cite{verma20063d}. The 3D reconstruction of roof shapes by evaluating satellite imagery was demonstrated by Blair~\cite{blair2012towards}. 

\section{Work packages and timeline}
\subsection{Packages}
\textbf{Segmenting the Point Cloud}
For getting a 2D outline of the buildings, we need to be able to segment out the point clouds into parts that belong to a plane which is up-right (and hence shows up as a line in the 2-D map) and the parts that are outliers to these planes.
To be able to do this, we first estimate the up-vector which is coplanar with the facades of the building and is normal to the ground. %The data we will be working upon, mostly includes pictures taken from ground level. So, the smallest eigenvector of the covariance matrix generated from the camera positions should be vertical to the ground and a reasonable approximation for the up-right vector. Even in the cases where we might not have a fully flat ground, one could break it down into piece-wise flat areas and estimate up-right vectors at each of these regions. \\

%Next thing to do would be to find the normal vector corresponding to each 3-D point by taking a patch in the point cloud around each of these points and calculating the smallest eigenvector of the covariance matrix obtained from the points belonging to this patch. The direction of the normal vectors can be used to estimate the probability of each point being normal to the up-right vector.

%Thresholding upon this probability measure helps in segmenting out the outliers and get the part of the point cloud that can be used to generate a 2-D outline that can be used in the next phase. One could also iteratively refine the point clouds using techniques like RANSAC ~\cite{fischler1981random} or Expectation Maximization ~\cite{dempster1977maximum}.

With the knowledge of the ground plane we can calculate a probability for a given point to be on a vertical plane, which makes it a candidate for being part of a wall. Projecting these points to a ground plane should give us a 2D facade map, similar to what is manually drawn in OSM.

Anurag will be working on this part and plans to build a catkin package in C++ which can run on 64-bit Linux machines.

\textbf{2D Matching} 
The idea for matching the outlines is to break it down to a 2D problem and use the Iterative Closest Point~\cite{icp} technique (ICP) to find the best match between the building outlines and the point cloud. %For that, a subset of the point cloud where all points are removed that are unlikely to belong to the facade are removed (i.e. points at the ground level).
A state-of-the-art ICP, such as libpointmatcher~\cite{Pomerleau12comp}, will then be used to align the point cloud.
%Investigations will be made on how well the complexity of OSM data can be reduced i.e., by removing holes and separations between buildings.

The first workpackage will be to use arbitrary GPS coordinates and build a simple interface to fetch and display OSM data. From the OSM data we will generate noisy test-input that we will use to evaluate the 2D-ICP approach.

Wolf plans on working on the Graphical User Interface and to implement the point matching by using the libpointmatcher. The interface will likely be written in Python with the ICP written in C++.

\textbf{Height and Roof Shape Estimation}
If time permits it would be interesting to perform a building height and roof shape estimation as that would be an interesting area where one could contribute data back to the OSM project\footnote{cf. \url{http://osmbuildings.org/}}.

Building heights can be estimated by analysing the points belonging to the vertical fa√ßade plane and finding maximum values (eventually by fitting a plane through the points).
The roof shape will likely be hard to estimate from a point cloud mainly taken from ground level. However, taking symmetry into account, it might be feasible to extract roof shape data for simple houses from as few as a single image, if the lines are clearly detectable and the image is from the right angle and aligned to the point cloud and OSM data. For more complex roof shapes it would require aerial imagery and fitting the correct planes into the roof point cloud.

The height estimation is likely to be in the scope of the project and will be a shared task. We are not yet sure if we can fit the roof shape estimation into the given time frame.	

\subsection{Timeline}
\noindent
\textbf{End of March} First prototype ready: ICP with ``handmade'' OSM data. PCL library evaluated and tested\\
\textbf{Mid April} Experiments done and functioning outline matching ready, normal \& upvector estimator done\\
\textbf{Mid of May} Tight integration of both workpackages, work on height (and maybe roof shape) guesser
\section{Outcomes and Demonstration}

Once fully implemented, our algorithm should be able to efficiently generate the 2D outline from a point cloud and find  the correct association between this outline and the building shapes from OSM. At the end of the semester, we plan to give a demonstration of the quality of the robustness of the matching algorithm to associate the outline with OSM, despite missing information, incomplete maps, noisy measurements and GPS readings.

If time permits we would like to show our contribution of building heights and roof shapes to \textit{OSM}.

{%\singlespace
{\small
\bibliography{refs}
\bibliographystyle{plain}}}

\end{document}